# InstrMCP Metadata Baseline Configuration
# This file reproduces the metadata from metadata_snapshot.json
# Use as a reference or for testing metadata configuration.
#
# To use: copy to ~/.instrmcp/metadata.yaml

version: 1
strict: true

tools:
  database_get_database_stats:
    title: "Database Statistics"
    description: |
      Check database exists and return health/stats.

      Args:
          database_path: optional string, path to the database file (absolute or relative); if omitted, uses the MeasureIt default or QCoDeS config.

  database_get_dataset_info:
    title: "Get Dataset Info"
    description: |
      Get detailed information about a specific dataset.

      Args:
          id: Dataset run ID to load
          database_path: optional string, database file path (absolute or relative); defaults to MeasureIt or QCoDeS config.
          detailed: bool, if `true`, return full info
          code_suggestion: dataset-loading code; 
          unsafe/dangerous mode -> auto-inserts+executes, safe returns a suggestion.

  database_list_all_available_db:
    title: "List Databases"
    description: |
      List all available QCodes databases.

      Searches common locations including MeasureIt databases directory
      and QCodes configuration paths.

      Args:
          detailed: bool, if true, also return measureit sweep and qcodes default config.

  database_list_experiments:
    title: "List Experiments"
    description: |
      List all experiments in the specified QCoDeS database.

      Args:
          database_path: optional string, database file path (absolute or relative); defaults to MeasureIt or QCoDeS config.
          scan_nested: bool, if true, also scan nested Databases/ subdirectories
          detailed: bool, If true, add path_resolved_via, experiment_count, per-experiment metadata
              (experiment_id, name, sample_name, start/end time, run_ids summary like "6-16(11)", (*) means total counts),
              and sweep_groups when detected.


  mcp_get_resource:
    title: "Get MCP Resource"
    description: |
      Retrieve the content of a specific MCP resource by its URI.

      Use this tool to access resource content. 

      Args:
          uri: string, resource URI (e.g., "resource://measureit_sweep1d_template")

      Returns:
          Resource content as JSON or text.

  mcp_list_resources:
    title: "List MCP Resources"
    description: |
      List all available MCP resources and guide.

      Use this tool to discover
      what context and documentation is available.

  measureit_get_status:
    title: "MeasureIt Status"
    description: |
      Check if any MeasureIt sweep is currently running.

      Args:
          detailed: bool, if false (default), if true, return adds sweep state and progress

  measureit_kill_sweep:
    title: "Kill Sweep"
    description: |
      Kill running MeasureIt sweep(s) to release resources.

      Args:
          variable_name: Name of the sweep variable in the notebook namespace
              (e.g., "sweep1d", "my_sweep"). Required when all=false.
          all: If true, kill all sweeps in namespace. If false (default),
              kill only the sweep specified by variable_name.

  measureit_wait_for_sweep:
    title: "Wait for Sweep"
    description: |
      Wait until MeasureIt sweep(s) finish.

      Args:
          timeout: Maximum time to wait in seconds (REQUIRED).
              Calculate based on sweep parameters to avoid hanging on stuck sweeps.
          variable_name: Name of the sweep variable to wait for. Required when all=false.
          all: If true, wait for all sweeps in namespace. If false (default),
              wait only for the sweep specified by variable_name.
          kill: If true (default), kill the sweep after waiting to release hardware
              resources. If false, skip killing (useful for polling without cleanup).
          detailed: If false (default), return only sweep state; if true, return full sweep information.

  notebook_add_cell:
    title: "Add Cell"
    description: |
      Add a new cell in the notebook. Cursor will move to the new cell, and notebook_execute_active_cell tool will execute this new cell.

      Args:
          cell_type: "code", "markdown", "raw" - default: "code"
          position: "above", "below", "end" - default: "below"
          content: default: empty string

      Returns: {"success": true/false, "error": "..." if failed}

  notebook_apply_patch:
    title: "Apply Patch"
    description: |
      Apply a patch to the current cell content.

      May require human consent.

      Args:
          old_text: Text to find and replace (must be unique in cell, cannot be empty)
          new_text: Text to replace with (can be empty to delete text)

      Returns: {"success": true/false, "error": "..." if failed}

  notebook_delete_cell:
    title: "Delete Cell"
    description: |
      Delete cell(s) from the notebook.

      May require human consent.

      Args:
        no input: delete current editing cell. 

        cell_id_notebooks: (Optional) JSON string of position indices to delete (0-indexed). You must read them before deleting.
        Example: "[0, 2, 5]" deletes cells at positions 0, 2, 5. 

      Returns: {"success": true/false, "error": "..." if failed}

  notebook_execute_active_cell:
    title: "Execute Cell"
    description: |
      Execute the currently active cell and return the output.

      May require human consent.

      Args:
          timeout: Maximum seconds to wait for execution to complete (default: 30.0). if 0, fire-and-forget.
          detailed: bool, If false (default), return concise summary; if true, return full info

      Returns (concise mode):
          - signal_success: Whether the execution request was sent successfully
          - status: "completed", "error", "timeout", or "no_wait"
          - executed: true if cell was executed
          - has_output, has_error: Boolean flags
          - outputs: List of cell outputs
          - error_type, error_message, traceback: If error occurred

      Returns (detailed mode - adds):
          - input: The code that was executed
          - sweep_detected: true if .start() was detected
          - suggestion: Hint to use wait tools if sweep detected
          - the output will not be summarized.

  notebook_read_active_cell:
    title: "Read Active Cell"
    description: |
      Get the currently active cell content from JupyterLab frontend.

      This captures the cell that is currently being edited in the frontend.

      Args:
          fresh_ms: Maximum age in milliseconds. If provided and cached data is older,
                   will request fresh data from frontend (default: 1000)
          line_start: Optional starting line number (1-indexed).
          line_end: Optional ending line number (1-indexed, inclusive).
          max_lines: Maximum number of lines to return (default: 200).
          detailed: bool, If false (default), return concise summary; if true, return full info

  notebook_read_active_cell_output:
    title: "Read Cell Output"
    description: |
      Get the output of the currently active cell in JupyterLab.

      This tool retrieves the output from the cell that is currently selected
      in JupyterLab, including any errors. If the cell hasn't been executed,
      it will indicate that status.

      Args:
          detailed: bool, If false (default), return concise summary; if true, return full info

      Returns:
          - cell_id_notebook: Position in notebook (0-indexed)
          - executed: true if cell has been executed, false otherwise
          - status: "completed", "error", "not_executed", or "not_code_cell"
          - has_output, has_error: Boolean flags
          - outputs: Cell outputs (detailed mode)
          - output_summary: Truncated output preview (concise mode)

  notebook_read_content:
    title: "Read Notebook Content"
    description: |
      Read notebook cells around the active cell (cursor position).
      Supports ALL cells including markdown and unexecuted cells.

      Args:
          num_cells: Number of cells to retrieve around cursor (default: 2)
          include_output: Include cell outputs and errors (default: true)
          cell_id_notebooks: (Optional) JSON string of specific position indices to fetch.
              Example: "[0, 2, 5]" fetches cells at positions 0, 2, 5 in the notebook.
              If provided, num_cells is ignored. Works for ALL cells.
          detailed: bool, If false (default), return concise summary; if true, return full info

      Response fields:
          - total_cells: Total number of cells in the notebook
          - cells: List of cell objects with:
              - cell_id_notebook: Position in notebook (0-indexed)
              - cell_type: "code", "markdown", or "raw"
              - executed: true if cell has been executed, false otherwise
              - source: Cell source code/content
              - has_output, has_error, status, outputs (when include_output=true)

  notebook_read_variable:
    title: "Read Variable"
    description: |
      Get detailed information about a notebook variable.

      Args:
          name: Variable name
          detailed: bool, If false (default), return concise summary; if true, return full info

  notebook_list_variables:
    title: "List Notebook Variables"
    description: |
      List variables in the Jupyter namespace.

      Args:
          type_filter: Optional type filter (e.g., "array", "dict", "instrument")

  notebook_move_cursor:
    title: "Move Cursor"
    description: |
      Move cursor to a different cell in the notebook.

      Changes which cell is currently active (selected) in JupyterLab.
      This is a SAFE operation as it only changes selection without modifying content.

      Args:
          target: Where to move the cursor:
                 - "above": Move to cell above current
                 - "below": Move to cell below current
                 - "bottom": Move to the last cell in the notebook (by file order)
                 - "index:N": Move to cell at position N (0-indexed). Works for ALL cells.
                             Example: "index:0" moves to first cell, "index:5" to 6th cell.

      Returns: {"success": true/false}

  notebook_server_status:
    title: "Server Status"
    description: "Get server status and configuration."

  notebook_update_editing_cell:
    title: "Update Active Cell"
    description: |
      Update the content of the currently editing cell in JupyterLab frontend.

      May require human consent.

      Args:
          content: string, New Python code content to set in the active cell
          detailed: bool, If false (default), return concise summary; if true, return full info

  qcodes_get_parameter_info:
    title: "Get Parameter Info"
    description: |
      Get metadata information about a specific QCodes parameter.

      Args:
          instrument: string, Instrument name in namespace
          parameter: Parameter path (e.g., "voltage", "ch01.voltage")
          detailed: bool. If true, return full data. 

      Returns:
          Parameter metadata including validator limits (vals).

  qcodes_get_parameter_values:
    title: "Get Parameter Values"
    description: |
      Get QCodes parameter values - supports both single parameter and batch queries.

      Args:
          queries: JSON string containing single query or list of queries
                   Single: {"instrument": "name", "parameter": "param", "fresh": false}
                   Batch: [{"instrument": "name1", "parameter": "param1"}, ...]
          detailed: bool, If false (default), return concise {instrument, parameter, value};
                   if true, return full response with timestamps and source info

  qcodes_instrument_info:
    title: "Get Instrument Info"
    description: |
      Get detailed information about a QCodes instrument.

      Args:
          name: Instrument name, or "*" to list all instruments
          with_values: Include parameter values in the response (only for specific instruments, not with "*")
          detailed: bool, If false (default), return concise summary; if true, return full response

      Note:
          To get live parameter values, use qcodes_get_parameter_values with:
          - "{instrument}.{parameter}" for direct parameters
          - "{instrument}.{channel}.{parameter}" for multi-channel instruments
          Example: "lockin.X" or "dac.ch01.voltage"

resources: {}

resource_templates:
  # Sweep templates (for running measurements)
  "resource://measureit_sweep0d_template":
    name: "MeasureIt Sweep0D Template"
    description: "Sweep0D code examples and patterns for time-based monitoring"

  "resource://measureit_sweep1d_template":
    name: "MeasureIt Sweep1D Template"
    description: "Sweep1D code examples and patterns for single parameter sweeps"

  "resource://measureit_sweep2d_template":
    name: "MeasureIt Sweep2D Template"
    description: "Sweep2D code examples and patterns for 2D parameter mapping"

  "resource://measureit_simulsweep_template":
    name: "MeasureIt SimulSweep Template"
    description: "SimulSweep code examples for simultaneous parameter sweeping"

  "resource://measureit_sweepqueue_template":
    name: "MeasureIt SweepQueue Template"
    description: "SweepQueue code examples for sequential measurement workflows"

  "resource://measureit_common_patterns":
    name: "MeasureIt Common Patterns"
    description: "Common MeasureIt patterns and best practices"

  "resource://measureit_code_examples":
    name: "MeasureIt Code Examples"
    description: "Complete collection of measureit code and resource link"

  # Data access templates (for loading saved data from database)
  "resource://database_access0d_template":
    name: "Database Access Sweep0D"
    description: "Code Template: Load Sweep0D time-based data from QCodes database"

  "resource://database_access1d_template":
    name: "Database Access Sweep1D"
    description: "Code Template: Load Sweep1D data from QCodes database"

  "resource://database_access2d_template":
    name: "Database Access Sweep2D"
    description: "Code Template: Load Sweep2D data from QCodes database (single run or parent group)"

  "resource://database_access_simulsweep_template":
    name: "Database Access SimulSweep"
    description: "Code Template: Load SimulSweep data from QCodes database"

  "resource://database_access_sweepqueue_template":
    name: "Database Access SweepQueue"
    description: "Code Template: Load SweepQueue batch data from QCodes database"
